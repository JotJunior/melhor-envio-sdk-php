<?php

require "./vendor/autoload.php";

use MelhorEnvio\Enums\Environment;
use MelhorEnvio\MelhorEnvioSdkPhp\Event;
use MelhorEnvio\MelhorEnvioSdkPhp\OAuth2;
use MelhorEnvio\MelhorEnvioSdkPhp\Shipment;
use MelhorEnvio\Resources\Shipment\Product;

$accessToken = "eeyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsImp0aSI6IjlkZmJhMWIzNTMxZTk0NDgxYzM1MzZmZjgzNDBlYjM5MTcxNDc1ODk1NTJlZGZlNzY1MGZjNmI4ZWFmMGMwM2IzZmQ0MTUwYjhhYmMxYzRlIn0.eyJhdWQiOiIyNjM1IiwianRpIjoiOWRmYmExYjM1MzFlOTQ0ODFjMzUzNmZmODM0MGViMzkxNzE0NzU4OTU1MmVkZmU3NjUwZmM2YjhlYWYwYzAzYjNmZDQxNTBiOGFiYzFjNGUiLCJpYXQiOjE2NDc0NTUxMTcsIm5iZiI6MTY0NzQ1NTExNywiZXhwIjoxNjUwMDQ3MTE3LCJzdWIiOiJjNDNiMzBjNS0zYWViLTRhYjYtYTQ3OS0yYjlmZWJiYzgwOTgiLCJzY29wZXMiOlsic2hpcHBpbmctY2FsY3VsYXRlIl19.V4AM9m0Ew4Z3kEnkf7pV4yuBllF3kCL9LdPWuifQp18vgSuOIvJYe-WwDsAZOM_9LyLQL4hXpzAJYUe5DUgFWjo8wn1sCUNi8DqERyuLP-emlrLpMMTSOEhNagVQNcuYeHh5WH1-hif6wTnAONXKmz8_f9LsV4njlQwOKjfffMCl8bF_0iazk8kp8l-bgoTfOpA-UxTNHv5TgVn4W0KciBOivlwm_cTseNEhtlLmSvxCKa2PO_6P2C8WcpocZid-Rp5jpFfB8w00QlB9WwuEC2J_5AFVjG4EPhGJhr4XWLoOwqklCuWGBjp3XHR6nKGWdrLzAHuaYwgthGquXRuxxmuI7DNgrisfJ_nabyn0I5kBbCPwjUSs5HbXCYc8DM8OcqewNbVjq-6O2G8PhYXKUasfG6UYNglkJTkBd2xUi1sF_Sl_aLTFA3liMVpmjknEglGkjqF-RB9Fq5OHK09OQ9pqtEuB6raulIGFVbsom-0aODO5InLSel90JcMhxLjkws3Jql-4uLkXb6k6-qGhKywt1DXWcq6PaOL7EDB7UjrkZMrd_Wd9mmo3hvEzzk-ofyNOWG7s1g1lSLCHTcjAYpxA9ulEO0GTg3Kn-rnnVj8EpI1b7C_rGrXnnNcEOBLxmN5RDbKtipISnpH8b7q3X6je6tC5YWv6dWIfUmX4F2I.eyJhdWQiOiIyNjM1IiwianRpIjoiMGFiZTg4YTZmZTk3MjEzNTZhNzUwMmM4ZGZhZDY0OWZhZWM1ZjhmNTY2M2Y0OTE3NzMyNDAzNjJiMTQyOGE4NTVmMjg4OGJjYzNhYmIzMWUiLCJpYXQiOjE2NDYzOTgzOTIsIm5iZiI6MTY0NjM5ODM5MiwiZXhwIjoxNjQ4OTkwMzkyLCJzdWIiOiJjNDNiMzBjNS0zYWViLTRhYjYtYTQ3OS0yYjlmZWJiYzgwOTgiLCJzY29wZXMiOlsic2hpcHBpbmctY2FsY3VsYXRlIl19.ktTYTdeloI03iRdbmeBSrLbxtl3BzgQLDtzAkwmHUNrNbPXZP7M1EjW89j4ONn8FLmvTVhGsQ6o4TR7pV-KfigY_AbswxLg4cCsdUW_ctu7aMwTGBk5Wojxi9N4vTxGaj1osSYTJZhjK1RYRdB5zH4eBPXWClZZB97P3wvyMSYWeJnqcPQWNhSdUhyofHj5_jalsxbX2nx7vbG3W8l7sYtuUXTEUxt73XD4XkyGicTYOWco1E2qQbrmwsjmhW2lQwpieJchxtHFx_Rc-TE43K5aoluLmUd7SDwlLHpV1AUZakaSnoPwueE_X_Fc3STiLXr0Vhiur5q0-TcT3jOn162dK8OzcEtQ40KptcrI9wAUHva28TXPfCvf29Esq1R7PKO5X48YbKEaCtAyFiEfwd61Nrl78436IbFMczS9IcslbSWrJefpnW6PXld8Ga81hJhSRjwi3Vkrrfi2Se7HkERcOEfAgMFJMmFQM2eXYOya6fvWYaCmqz8B5450_GIwF1_qQeQSoyvLmi1GIeI_NKL2IetIBpasuVZ1WWSi11unavHuUAdCl2XrAg7qIt0b3dJzVw9BqOMURhBjLTIDmI6dKc6wmLiUQE3QaNvOFLx5haECnhHL9dcJcpAnhjUE1VuxBSZL7KVyRn58qG0Fo8PzsrlLV7EwyhuVOqWh9_RU.eyJhdWQiOiIyNjM1IiwianRpIjoiNTIzYWE4YzIxNjRiZDViZWE4YTMxZjk1YmNlMWRhNGRmY2Y2OWU4YWI4Y2VjNmU3MDc1MmQzMzU5MjEwZGFhZWVlM2Y2YWJkNTQyMDdkYTMiLCJpYXQiOjE2NDYwNzI1NzIsIm5iZiI6MTY0NjA3MjU3MiwiZXhwIjoxNjQ4NjY0NTcyLCJzdWIiOiJjNDNiMzBjNS0zYWViLTRhYjYtYTQ3OS0yYjlmZWJiYzgwOTgiLCJzY29wZXMiOltdfQ.HuRlBQy33xdTd-MxiPvpY4DidpYgTP1jX7z2z0llUetk4QNjSO_xAouq3JSG4sYJHxx1kDaZquRkpbmX4a_o2IPf-ZkgmZ0aKp0z0mpxS-ay7bB4s9dDo7nCLmtrjd71qljNPyuYPn-HVO2ispY-8p-15QhWKf1tuFWkEck5kWcNvBnSj1H-4wLyU9QJ8sDZoTxxpdxfo0cE4Vv0EUB8GCnVc1YrmrtGAKhUxM1T_PITinF2ZI_6I2eiyk2p2Z0x5CPeqUVe87DGIn9OGCVFphZfQCcQRaGEPO6amTtSRl3a8sHzBWn5bZ3xq1vYZQbHrLhuMNmaUJqa-bUWw2lkRyOCQv0PQ2jJlRP-aOMWzPG3oXTq5vjJApIvDgIYyjAy-HbA8vrJM_9jWIJCam4frqa5OWYkLhHCqIsbg9txuqDfVGVn3Ah6DTJyXAfPzjuobMBzEeV5NjWkdIPoV7TKqyTOie3dpyQOBFqNFxpWNoOfFTuEDdRH3aIzUQxS1ENgIEWP7SeALXc3SsT7wczEM6oMicg7EGOIpruERbnYvJ8-XojePHLMVIBYTog8AnGnwxQ5Q0UDpSfGNxxh9JaY19AJqQYgzA9_z-DBR0dlFMpF7_GaAtdbXGcQTFyTps1_C2x6vqrFbKHnNmrEuRy22Lx3J0-9Jxuo5MtY-DqkW6M.eyJhdWQiOiIyNjM1IiwianRpIjoiMzI3OTVlNGRiMmFlOGY4MWViNjU2OWUxMWY3YzIzMjVkM2RmMTI3ZjAzMjJkMDk3Zjc0MjNlMzgwYjcwZmJkYzIwMjgzYmU4MTcwYzBkMWIiLCJpYXQiOjE2NDU3OTQzOTIsIm5iZiI6MTY0NTc5NDM5MiwiZXhwIjoxNjQ4Mzg2MzkyLCJzdWIiOiJjNDNiMzBjNS0zYWViLTRhYjYtYTQ3OS0yYjlmZWJiYzgwOTgiLCJzY29wZXMiOlsic2hpcHBpbmctY2FsY3VsYXRlIl19.aimxkPqdnKrt4Qx3W8Oqf3pWtEVP2gCxheoAlxnqlsJDdk2Qtud3mdEy3bjBIMNEWOaA30iBMdUTY2RCO23fis9gcrpGLuol2VDbh21ENSK9a7-30cJEayaQGiKki1GHmjwGTuGxOYq-7jnShnTBR1qWP3eOY4fTTg_IV8Cg7ET9VuQ-x0xdwWRxbP65uWqM2l-BEZYIz4om8ctN44DDVEaXPt2KolnSq7atcpn9dgqtJEeFkiiFXMKnIxnm-DP9-lr0WYr1VkIuO_nDK937CFV6J0G82Q-203VXTzEshH1ChWLkke4JquecM1JY2kNjQBH5OsUjfrvyfzJ7h_qJtfrG-3Q_qt8NNWbROi1c_xbIZV-cOcKTLdAXu_7nY8HUPbjKlatKI4RP-5pY9u0KErhzLnsN8V3uAeTmkSop0jYXg87dcKs0RN8Dzv_lv9BRLYt0fKu-bTdDB6X5vGt4pdJbqHZGIKkKuzQirkNZSrboRx3mB7eBkrKBs5Sw0ancjsFD0OfQ4YOCaBL4qD9gLzBoucZmmVRs6y6NXKm03dWufv42g4PW8aeksIoAtdo0nHoVFK9Gwefx6CSxDBNELFNAsFe83NvlP9DBEX8oxzwY9uYsW0TtVFJIV5XilW0pLY37RdPmJBzpxl3N7f1wQV1gl8jM8hfuA3_Za9KhTL4";
$refreshToken = "def50200ed7ee974d7046f456e30b3cf110745bb12929e37b29e2100197f4c69bcd3194c46e7a69689a09832c91d9ad0511b259949231e36ae6312ed793d225ef981de6aa1496f8ff7b0c5111dc799c0fbc621dd4b593dac5a020c028ce52360074371457f190a6b928deb357d6ef271cd70b59efb0fc7d0ca06f1394582a1679e2c9067f089ad6244da41d809c70703b1228131c9f3b6c37c65f14e2560e79c38126311adbc127baaf4615234e88a8d3b9055369f2b0d02d8369d8507829943be2c50d2d7fdf2e1c1f84eebc1215bb4bf270c0a01eb5e1c4a92d73d26abe6d24369b173c2257d7024b3ec4fc9d02b4c0b2d74c6d1c424d208e16e7fbc9eeda36c1923d620907000517577f58dbe03bd2b4824af8342c310df5f425bff46b6a76e3b788b0547c7f0ad777d3f66817a56d04d3b0125bac1c805e6fa8dc7fd1b0a54bacb78ed2d4856a5df584607868c6c3ba6a5ac50c2251a3ea515a055248c11aaf0fcc3fdda9b45dc0bc955fc62dbd638887488c0b56f0598f9dd3d9af42edf68249f3fb0ae271562cc03a5b4009ad0d33e115dfad8939933abd88481";

$appData = [
    'client_id' => 2635,
    'client_secret' => 'O9WeVIi7zzCNhqveldS7oEm0YSF5lU6gCilnSkRj',
    'redirect_uri' => 'https://bridge-woocommerce.test/callback'
];

Event::listen('refresh', function ($token, $refreshToken) {
    // Put here trading rule to save accessToken e refreshToken.
});

$oAuth2 = new OAuth2(
    $appData['client_id'],
    $appData['client_secret'],
    $appData['redirect_uri']
);

$shipment = new Shipment(
    $oAuth2,
    $accessToken,
    $refreshToken
);

$calculator = $shipment->calculator();

$calculator->postalCode('01010010', '20271130');

$calculator->setOwnHand();
$calculator->setReceipt(false);
$calculator->setCollect(false);

$calculator->addProducts(
    new Product(uniqid(), 40, 30, 50, 10.00, 100.0, 1),
    new Product(uniqid(), 5, 1, 10, 0.1, 50.0, 1)
);

$quotations = $calculator->calculate();

var_dump($quotations);
